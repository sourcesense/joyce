(self.webpackChunkjoyce_docs=self.webpackChunkjoyce_docs||[]).push([[946],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return m},kt:function(){return h}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),p=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},l=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),l=p(n),h=o,d=l["".concat(c,".").concat(h)]||l[h]||u[h]||r;return n?a.createElement(d,s(s({ref:t},m),{},{components:n})):a.createElement(d,s({ref:t},m))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=l;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var p=2;p<r;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}l.displayName="MDXCreateElement"},7029:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return i},toc:function(){return c},default:function(){return m}});var a=n(2122),o=n(9756),r=(n(7294),n(3905)),s={},i={unversionedId:"import-gateway",id:"import-gateway",isDocsHomePage:!1,title:"Import Gateway",description:"The Import Gateway is the single point where you ingest your data into the system.",source:"@site/docs/40-import-gateway.md",sourceDirName:".",slug:"/import-gateway",permalink:"/joyce/docs/import-gateway",editUrl:"https://github.com/sourcesense/joyce/edit/main/docs/docs/40-import-gateway.md",version:"current",sidebarPosition:40,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"What is a schema?",permalink:"/joyce/docs/schema"},next:{title:"Connectors",permalink:"/joyce/docs/connectors"}},c=[{value:"Import API",id:"import-api",children:[{value:"REST API",id:"rest-api",children:[]},{value:"Kafka Consumer API",id:"kafka-consumer-api",children:[]}]},{value:"Schema Management",id:"schema-management",children:[{value:"Developing mode",id:"developing-mode",children:[]}]},{value:"Connectors API",id:"connectors-api",children:[]}],p={toc:c};function m(e){var t=e.components,n=(0,o.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The Import Gateway is the single point where you ingest your data into the system.",(0,r.kt)("br",{parentName:"p"}),"\n","It manages import schemas and applies them to the content you send to it."),(0,r.kt)("p",null,"You can image it as a function that given a schema and a content as input it outputs the content transformed as the schema describes."),(0,r.kt)("p",null,"It has two functions: Managing schemas and Import Content."),(0,r.kt)("h2",{id:"import-api"},"Import API"),(0,r.kt)("p",null,"Import Gateway has two interface to process source content a ",(0,r.kt)("strong",{parentName:"p"},"REST API")," and a ",(0,r.kt)("strong",{parentName:"p"},"Kafka Consumer API"),"."),(0,r.kt)("h3",{id:"rest-api"},"REST API"),(0,r.kt)("p",null,"Swagger docuemntation can be find here ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:6651/docs"},"http://localhost:6651/docs"),".",(0,r.kt)("br",{parentName:"p"}),"\n","To specify the schema to use you have to set a custem header ",(0,r.kt)("inlineCode",{parentName:"p"},"X-Joyce-Schema-Id"),".",(0,r.kt)("br",{parentName:"p"}),"\n","Different endpoints let you insert/delete a single content, bulk insert from a csv or just testing a scehma transformation with a dry run."),(0,r.kt)("h4",{id:"post-apiimport"},"POST /api/import"),(0,r.kt)("p",null,"Applies the ",(0,r.kt)("strong",{parentName:"p"},"schema")," specified by ",(0,r.kt)("inlineCode",{parentName:"p"},"X-Joyce-Schema-Id"),"  and publish the processed content to ",(0,r.kt)("inlineCode",{parentName:"p"},"content-topic")," and returns the id generated for the content."),(0,r.kt)("h4",{id:"delete-apiimport"},"DELETE /api/import"),(0,r.kt)("p",null,"Applies the ",(0,r.kt)("strong",{parentName:"p"},"schema")," specified by ",(0,r.kt)("inlineCode",{parentName:"p"},"X-Joyce-Schema-Id")," and publish an empty message to mark the deletion of the given content."),(0,r.kt)("h4",{id:"post-apiimportbulk"},"POST /api/import/bulk"),(0,r.kt)("p",null,"Applies the ",(0,r.kt)("strong",{parentName:"p"},"schema")," specified by ",(0,r.kt)("inlineCode",{parentName:"p"},"X-Joyce-Schema-Id")," to every line of the csv sent as multipart along the http request and publish a message to ",(0,r.kt)("inlineCode",{parentName:"p"},"content-topic")," for every line transofrmed.",(0,r.kt)("br",{parentName:"p"}),"\n","The csv has to be valid and the first line is parsed as header giving name to columns."),(0,r.kt)("h4",{id:"post-apiimportdryrun"},"POST /api/import/dryrun"),(0,r.kt)("p",null,"Applies the ",(0,r.kt)("strong",{parentName:"p"},"schema")," specified by ",(0,r.kt)("inlineCode",{parentName:"p"},"X-Joyce-Schema-Id")," and returns syncronously the result of the processing, WITHOUT pushing it inside kafka."),(0,r.kt)("h3",{id:"kafka-consumer-api"},"Kafka Consumer API"),(0,r.kt)("p",null,"Import Gateway consumes messages from ",(0,r.kt)("inlineCode",{parentName:"p"},"joyce_import"),", it exepcts the message to have a Json message key in this form:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "uid": "someUniqueValue",\n  "schema": "joyce://schema/import/project",\n  "source": "jdbc-source-project"\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"uid")," is a unique identifier of the imported content "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"schema")," is the uri of the schema to apply"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"source")," identify the source of the content")),(0,r.kt)("p",null,"This information can be configured to be set on a ",(0,r.kt)("a",{parentName:"p",href:"connectors"},"Kafka Connect")," with a transformation configuration."),(0,r.kt)("p",null,"If you specify the ",(0,r.kt)("a",{parentName:"p",href:"schema#connectors"},"connectors inside the schema")," the transformation to obtain a suitable key for the scheam is done automatically by import gateway. ",(0,r.kt)("strong",{parentName:"p"},"This is the preferred way"),"."),(0,r.kt)("h2",{id:"schema-management"},"Schema Management"),(0,r.kt)("p",null,"Input Gateway has a CRUD REST interface to manage ",(0,r.kt)("a",{parentName:"p",href:"schema"},"Schemas"),", you can access its swagger documentation at ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:6651/docs"},"http://localhost:6651/docs"),"."),(0,r.kt)("p",null,"With it you can do what you expect, create, read, update and delete schemas for a namespace, you can also list namespaces.\nUpdating schemas has few constraints, because the system tries to keep consistency within the data inside the system, preventing changes to the schema that can corrupt previous imported data."),(0,r.kt)("p",null,"When you upsert a schema, checks are made to understand what has changed, if there are ",(0,r.kt)("strong",{parentName:"p"},"breaking changes")," the schema cannot be saved."),(0,r.kt)("p",null,"Breaking changes are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"remove a required property"),(0,r.kt)("li",{parentName:"ul"},"change the type of property")),(0,r.kt)("h3",{id:"developing-mode"},"Developing mode"),(0,r.kt)("p",null,"Where you are in the process of developing a schema, you can bypass these checks by flagging the schema in developing mode, by putting this value in the Schema metadata"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"$metadata:\n  ...\n  development: true\n")),(0,r.kt)("p",null,"This will save the content but it doesn't gurantee that data is validated against the schema when saved in the storage."),(0,r.kt)("p",null,"Once you set ",(0,r.kt)("inlineCode",{parentName:"p"},"development: false")," in a schema you ",(0,r.kt)("strong",{parentName:"p"},"cannot go back"),". "),(0,r.kt)("h2",{id:"connectors-api"},"Connectors API"),(0,r.kt)("p",null,"By configuring connectors directly inside the schema, ",(0,r.kt)("inlineCode",{parentName:"p"},"import-gateway")," expose additional resources on the schema resource to control kafka connect tasks."),(0,r.kt)("h4",{id:"get-apischemasubtypenamespacenameconnectors"},"GET /api/schema/{subtype}/{namespace}/{name}/connectors"),(0,r.kt)("p",null,"List connectors and their configurations, present in the schema definition."),(0,r.kt)("h4",{id:"get-apischemasubtypenamespacenameconnectorsconnectorstatus"},"GET /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/status"),(0,r.kt)("p",null,"Output the status of the connector."),(0,r.kt)("h4",{id:"post-apischemasubtypenamespacenameconnectorsconnectorrestart"},"POST /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/restart"),(0,r.kt)("p",null,"Restart the given connector."),(0,r.kt)("h4",{id:"put-apischemasubtypenamespacenameconnectorsconnectorpause"},"PUT /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/pause"),(0,r.kt)("p",null,"Pause tasks of the given connector."),(0,r.kt)("h4",{id:"put-apischemasubtypenamespacenameconnectorsconnectorresume"},"PUT /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/resume"),(0,r.kt)("p",null,"Restart tasks of the given connector."))}m.isMDXComponent=!0}}]);