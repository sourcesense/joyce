(self.webpackChunkjoyce_docs=self.webpackChunkjoyce_docs||[]).push([[613],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return p},kt:function(){return h}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(a),h=o,u=d["".concat(l,".").concat(h)]||d[h]||m[h]||i;return a?n.createElement(u,r(r({ref:t},p),{},{components:a})):n.createElement(u,r({ref:t},p))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=a[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9490:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return r},metadata:function(){return s},toc:function(){return l},default:function(){return p}});var n=a(2122),o=a(9756),i=(a(7294),a(3905)),r={title:"Tutorial"},s={type:"mdx",permalink:"/joyce/tutorial-accomodations",source:"@site/src/pages/tutorial-accomodations.md"},l=[{value:"Goal",id:"goal",children:[]},{value:"Setup",id:"setup",children:[]},{value:"Write Schemas",id:"write-schemas",children:[{value:"Parent Schema",id:"parent-schema",children:[]},{value:"Save schema",id:"save-schema",children:[]},{value:"Setup joyce-rest",id:"setup-joyce-rest",children:[]},{value:"Write first child schema",id:"write-first-child-schema",children:[]}]},{value:"Bulk import the file",id:"bulk-import-the-file",children:[]},{value:"Notifications &amp; Troubleshooting",id:"notifications--troubleshooting",children:[]},{value:"Consume REST api",id:"consume-rest-api",children:[]},{value:"Other data sources",id:"other-data-sources",children:[]},{value:"Conclusion",id:"conclusion",children:[]}],c={toc:l};function p(e){var t=e.components,r=(0,o.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-build-with-joyce-a-unified-api-for-italian-regional-hotels"},"How to build with Joyce a Unified API for italian regional hotels"),(0,i.kt)("p",null,"This tutorial is a practical, non trivial, real world example of how you can use Joyce platform.",(0,i.kt)("br",{parentName:"p"}),"\n","We'll go step by step through the creation a complete flow of data integration and serving of a final API."),(0,i.kt)("h2",{id:"goal"},"Goal"),(0,i.kt)("p",null,"We want to create an API that expose information on all italian territory tourism accomodation (Hotels, B&B, ...). Our data source are the data that every singular region publishes as open data on ",(0,i.kt)("a",{parentName:"p",href:"http://www.datiopen.it/en/catalogo-opendata/turismo-0"},"this site"),".",(0,i.kt)("br",{parentName:"p"}),"\n","We can download csv data of the accomodation region by region, the only problem is that every region exports data in similar but slighlty different way, some information are present or not, others have different column names.   "),(0,i.kt)("p",null,"What we want is to have a unified api for all the data and be able to update it over time.",(0,i.kt)("br",{parentName:"p"}),"\n","We'll use Joyce to do everything, we'll define the shape of the final data with a Schema, and then we'll write a child schema for every different data source and describe its transofrmation.",(0,i.kt)("br",{parentName:"p"}),"\n","We then use the bulk import capability of joyce to  import and transform all the data."),(0,i.kt)("h2",{id:"setup"},"Setup"),(0,i.kt)("p",null,"You'll need to have docker installed, we'll be using docker-compose to sturtup a minimal installation of Joyce."),(0,i.kt)("p",null,"Let's begin:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir italian-accomodations\ncd italian-accomodations\nwget https://raw.githubusercontent.com/sourcesense/joyce-compose/master/docker-compose.yaml\n\ndocker-compose up -d\n")),(0,i.kt)("p",null,"Once everything is up (it will take a while, check  with ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose ps"),") you'll have:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"import-gateway")," API at ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:6651/docs"},"http://localhost:6651/docs")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"rest")," API at ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:6650/docs"},"http://localhost:6650/docs")),(0,i.kt)("li",{parentName:"ul"},"AKHQ at ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:6680/"},"http://localhost:6680/"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest")," has no endpoint configured, we must tell him about the collection/schema we want to expose, to do that we must first create a schema on ",(0,i.kt)("inlineCode",{parentName:"p"},"import-gateway")," and then tell the ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest")," about it."),(0,i.kt)("p",null,"First things first, let's shape the data we ant for our accomodation api."),(0,i.kt)("h2",{id:"write-schemas"},"Write Schemas"),(0,i.kt)("p",null,"A schema inside Joyce is a ",(0,i.kt)("inlineCode",{parentName:"p"},"json-schema")," with an embedded DSL to make transformation, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/schema"},"Schema docs"),".",(0,i.kt)("br",{parentName:"p"}),"\n","In our case things are more complex, we want a parent Schema with no transformations that represents the data we will serve, and several child schema with the actual transformation, one for every different source format (every italian region exports a csv with a different set of fields)."),(0,i.kt)("p",null,"Something like this:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"schemas",src:a(8513).Z})),(0,i.kt)("h3",{id:"parent-schema"},"Parent Schema"),(0,i.kt)("p",null,"Save this file to ",(0,i.kt)("inlineCode",{parentName:"p"},"import-accomodation.yaml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"$schema: https://joyce.sourcesense.com/v1/schema\n$metadata:\n  subtype: import\n  namespace: default\n  name: accomodation\n  description: A model that represents Accomodations\n  development: true\n  collection: accomodations\n  uid: code\ntype: object\nproperties:\n  code:\n    type: string\n  name:\n    type: string\n  email:\n    type: string\n  phone:\n    type: string\n  website:\n    type: string\n  location:\n    type: object\n    properties:\n      city:\n        type: string\n      region:\n        type: string\n      cap:\n        type: integer\n")),(0,i.kt)("p",null,"This is a simple ",(0,i.kt)("inlineCode",{parentName:"p"},"json-schema")," that shape and validate our data, the only strange thing is the ",(0,i.kt)("inlineCode",{parentName:"p"},"$metadata")," node, this tells our system what to do with content generated with this schema, most important fields are ",(0,i.kt)("inlineCode",{parentName:"p"},"collection")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"uid")," taht respectively tells Joyce to which collection content  will  be  stored and which key is to be considered as unique id.",(0,i.kt)("br",{parentName:"p"}),"\n","Refer to ",(0,i.kt)("a",{parentName:"p",href:"/docs/schema"},"Schema docs")," for further info."),(0,i.kt)("h3",{id:"save-schema"},"Save schema"),(0,i.kt)("p",null,"Now we will register this schema to the ",(0,i.kt)("inlineCode",{parentName:"p"},"import-gateway"),", either use following curl or do the same with the swagger ui."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST -H "Content-Type: application/x-yaml" --data-binary @import-accomodation.yaml http://localhost:6651/api/schema\n')),(0,i.kt)("p",null,"If everything is fine you'll have the schema registered:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:6651/api/schema\n")),(0,i.kt)("h3",{id:"setup-joyce-rest"},"Setup joyce-rest"),(0,i.kt)("p",null,"Now we should tell ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest")," about this schema."),(0,i.kt)("p",null,"Edit ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," and add this to environment variables of ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest")," service:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"- SCHEMAS_SOURCE=/opt/schemas.json\n")),(0,i.kt)("p",null,"and this volume:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'volumes: \n  - "./schemas.json:/opt/schemas.json"\n')),(0,i.kt)("p",null,"then save this json to ",(0,i.kt)("inlineCode",{parentName:"p"},"schemas.json")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{   \n    "schemas": {\n        "accomodation": {\n            "source": "http://import-gateway:6651/api/schema/import/default/accomodation"\n        }\n    }\n}\n')),(0,i.kt)("p",null,"Finally restart ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose stop rest\ndocker-compose up -d rest\n")),(0,i.kt)("p",null,"You should now see at ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:6650/docs"},"http://localhost:6650/docs")," the accomodation endpoint exposed."),(0,i.kt)("p",null,"But obviously there is no data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "http://localhost:6650/accomodation?orderBy=asc&sortBy=name"\n[]\n')),(0,i.kt)("h3",{id:"write-first-child-schema"},"Write first child schema"),(0,i.kt)("p",null,"Before writing our first child schema we must know how our source data is shaped, go ",(0,i.kt)("a",{parentName:"p",href:"http://www.datiopen.it/en/catalogo-opendata/turismo-0"},"here")," and download the Regional data for Veneto."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "http://www.datiopen.it/export/csv/Regione-Veneto---Elenco-strutture-ricettive.csv" | iconv -f iso8859-1 -t utf-8 > veneto.csv\n')),(0,i.kt)("p",null,"We pipe through iconv because we have to convert the file to utf-8 before processing."),(0,i.kt)("p",null,"Open the csv with your preferred editor and have a look at it (yep it is in italian, sorry ), so we can understand how to make the transformation to obtain our final data."),(0,i.kt)("p",null,"Here's the result, save it to ",(0,i.kt)("inlineCode",{parentName:"p"},"import-accomodation-veneto.yaml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'$schema: https://joyce.sourcesense.com/v1/schema\n$metadata:\n  subtype: import\n  namespace: default\n  name: accomodation-veneto\n  description: A model that represents Accomodations for Veneto regional data\n  development: true\n  parent: joyce://schema/import/default.accomodation\ntype: object\nproperties:\n  code:\n    type: string\n    $path: "$[\'Codice identificativo\']"\n  name:\n    type: string\n    $path: "$.Denominazione"\n  email:\n    type: string\n    $path: "$[\'Posta elettronica\']"\n  phone:\n    type: string\n    $path: "$.Telefono"\n  website:\n    type: string\n    $path: "$[\'Sito internet\']"\n  location:\n    type: object\n    properties:\n      city:\n        type: string\n        $path: "$.Comune"\n      region:\n        type: string\n        $fixed: "Veneto"\n      cap:\n        type: integer\n        $path: "$.CAP"\n  tipology:\n    type: string\n    $path: "$.Tipologia"\n')),(0,i.kt)("p",null,"You see it has the same shape of our parent schema, but for every field we've used the ",(0,i.kt)("inlineCode",{parentName:"p"},"$path")," handler to retrieve with a ",(0,i.kt)("inlineCode",{parentName:"p"},"json-path")," expression the actual value we wanted (see ",(0,i.kt)("a",{parentName:"p",href:"/docs/schema"},"docs")," for other handlers and their usage )."),(0,i.kt)("p",null,"We also added a field ",(0,i.kt)("inlineCode",{parentName:"p"},"tipology")," that we will store, but not serve within the api because it is not present on every source data.   "),(0,i.kt)("p",null,"Go ahead and save this schema too as before."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST -H "Content-Type: application/x-yaml" --data-binary @import-accomodation-veneto.yaml http://localhost:6651/api/schema\n')),(0,i.kt)("p",null,"A curl to retrieve schemas now should have this output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -Ss http://localhost:6651/api/schema | jq\n[\n  {\n    "uid": "joyce://schema/import/default.accomodation-veneto",\n    "name": "accomodation-veneto",\n    "description": "A model that represents Accomodations for Veneto regional data",\n    "development": true\n  },\n  {\n    "uid": "joyce://schema/import/default.accomodation",\n    "name": "accomodation",\n    "description": "A model that represents Accomodations",\n    "development": true\n  }\n]\n')),(0,i.kt)("p",null,"We are now ready to test our schema, get a sample json from the csv with this python fu:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"head -n 2 Regione-Veneto---Elenco-strutture-ricettive.csv | python -c 'import csv;import json; from io import StringIO; import sys;reader = csv.DictReader(StringIO(sys.stdin.read()), delimiter=\";\"); print(json.dumps(list(reader), indent=2))'\n")),(0,i.kt)("p",null,"Copy the json element and use ",(0,i.kt)("inlineCode",{parentName:"p"},"import-gateway")," swagger-ui to test the schema by using ",(0,i.kt)("inlineCode",{parentName:"p"},"\u200b/api\u200b/import\u200b/dryrun")," dryrun endpoint, in the header put the schema id ``. "),(0,i.kt)("p",null,"Put in schema id ",(0,i.kt)("inlineCode",{parentName:"p"},"accomodation-veneto")," and you should have the transofrmed json as output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "result": {\n    "code": "307",\n    "name": "CAORSA",\n    "email": "info@caorsa.it",\n    "phone": "0457235039",\n    "website": "www.caorsa.it",\n    "location": {\n      "city": "AFFI",\n      "region": "Veneto",\n      "cap": 37010\n    },\n    "tipology": "AFFITTACAMERE"\n  }\n}\n')),(0,i.kt)("p",null,"The transformation seems fine, try to really import it now by using the import endpoint ",(0,i.kt)("inlineCode",{parentName:"p"},"\u200b/api\u200b/import\u200b"),"."),(0,i.kt)("p",null,"try to query now ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "http://localhost:6650/accomodation?orderBy=asc&sortBy=name"\n')),(0,i.kt)("p",null,"You should see your imported document transofrmed."),(0,i.kt)("h2",{id:"bulk-import-the-file"},"Bulk import the file"),(0,i.kt)("p",null,"Time now to import the whole document.",(0,i.kt)("br",{parentName:"p"}),"\n","from swagger use the ",(0,i.kt)("inlineCode",{parentName:"p"},"\u200b/api\u200b/import\u200b/bulk")," import, set the schema id and change the separators accordingly ",(0,i.kt)("inlineCode",{parentName:"p"},";")," for column and ",(0,i.kt)("inlineCode",{parentName:"p"},",")," for array elemnts."),(0,i.kt)("p",null,"Then choose the csv to import."),(0,i.kt)("p",null,"Output will be an error message, something like :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "message": "com.sourcesense.joyce.schemaengine.exception.InvalidSchemaException: $.location.cap: null found, integer expected",\n  "error": "com.sourcesense.joyce.core.exception.NotifiedException"\n}\n')),(0,i.kt)("p",null,"This means something went wrong processing an entry.\nWhen bulk importing, the process stops at the first error giving you notice of it syncronously, but indeed the good ones before were correctly processed. "),(0,i.kt)("p",null,"You can consume the api to see it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "http://localhost:6650/accomodation?orderBy=asc&sortBy=name"\n')),(0,i.kt)("p",null,"Let's go deeper and see what happened..."),(0,i.kt)("h2",{id:"notifications--troubleshooting"},"Notifications & Troubleshooting"),(0,i.kt)("p",null,"When a content enter inside Joyce platform, it gets uris to be identified across the steps it pass through, and every component that interact with it sends notification of success or failure on ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-notification")," kafka topic."),(0,i.kt)("p",null,"You can do whatever you like with them and they are structured in a way that it is easy to track flow of a content."),(0,i.kt)("p",null,"If you have an ELK stack within your infrustructure it's easy to setup a Kafka Connect connector to sink notifications on an Elasticsearch index."),(0,i.kt)("p",null,"For a quick troubleshoot without this overhead we can use akhq to read errors notification, go to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:6680/"},"http://localhost:6680/")," and select topic ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce_notification")," in the search box insert ",(0,i.kt)("inlineCode",{parentName:"p"},"IMPORT_INSERT_FAILED")," few message should pop up:"),(0,i.kt)("p",null,"We are interested in metadata field: ",(0,i.kt)("inlineCode",{parentName:"p"},"$.location.cap: null found, integer expected")," schema was expecting an Integer instead he got an empty value, you can view the content that triggered this error:"),(0,i.kt)("p",null,"you'll see that the json has ",(0,i.kt)("inlineCode",{parentName:"p"},'"CAP":""')," the cause of our error."),(0,i.kt)("p",null,"Now based on how you want your data, either you can ignore the error and reject the entry, being sure all entry have the correct info, or you can relax the schema and import content with this missing data anyway."),(0,i.kt)("p",null,"For the purpose of exercise we'll change the schema to accept nullable values on ",(0,i.kt)("inlineCode",{parentName:"p"},"cap")," field.",(0,i.kt)("br",{parentName:"p"}),"\n","Open ",(0,i.kt)("inlineCode",{parentName:"p"},"import-accomodation-veneto.yaml")," and change the description of ",(0,i.kt)("inlineCode",{parentName:"p"},"cap")," field as follows"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'cap:\n  type: ["integer", "null"]\n  $path: "$.CAP"\n')),(0,i.kt)("p",null,"Update the schema on the Import Gateway:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -H "Content-Type: application/x-yaml" --data-binary @import-accomodation-veneto.yaml http://localhost:6651/api/schema\n')),(0,i.kt)("p",null,"We must do the same for the parent schema, because the produced json is verified against the parent schema too, make the same change on ",(0,i.kt)("inlineCode",{parentName:"p"},"import-accomodation.yaml")," and save it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -H "Content-Type: application/x-yaml" --data-binary @import-accomodation.yaml http://localhost:6651/api/schema\n')),(0,i.kt)("p",null,"Use again the bulk import call from swagger with the same file."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Don't worry for the reprocessing of all the lines, the operation is idempotent, docs with the same id will just be overwritten."))),(0,i.kt)("h2",{id:"consume-rest-api"},"Consume REST api"),(0,i.kt)("p",null,"Now you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest")," and get data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "http://localhost:6650/accomodation?orderBy=asc&sortBy=name"\n\n# use pagination and ordering\ncurl "http://localhost:6650/accomodation?orderBy=desc&sortBy=name&size=10&page=4"\n\n# Get a single object\ncurl "http://localhost:6650/accomodation/1704"\n')),(0,i.kt)("h2",{id:"other-data-sources"},"Other data sources"),(0,i.kt)("p",null,"Go to ",(0,i.kt)("a",{parentName:"p",href:"http://www.datiopen.it/en/catalogo-opendata/turismo-0"},"the site")," and download data for Sicily region:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "http://www.datiopen.it/export/csv/Regione-Sicilia---Mappa-delle-strutture-ricettive.csv" | iconv -f iso8859-1 -t utf-8 > sicily.csv\n')),(0,i.kt)("p",null,"Again with python kung-fu get one entry to view how data is: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"head -n 2 data/connect/toprocess/Regione-Sicilia---Mappa-delle-strutture-ricettive.csv | python -c 'import csv;import json; from io import StringIO; import sys;reader = csv.DictReader(StringIO(sys.stdin.read()), delimiter=\";\"); print(json.dumps(list(reader), indent=2))'\n")),(0,i.kt)("p",null,"and write a new schema to ",(0,i.kt)("inlineCode",{parentName:"p"},"import-accomodation-sicily.yaml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'$schema: https://joyce.sourcesense.com/v1/schema\n$metadata:\n  subtype: import\n  namespace: default\n  name: accomodation-sicilia\n  description: A model that represents Accomodations for Sicilia regional data\n  development: true\n  parent: joyce://schema/import/default.accomodation\ntype: object\nproperties:\n  code:\n    type: string\n    $path: "$.Codice"\n  name:\n    type: string\n    $path: "$.Nome"\n  email:\n    type: string\n    $path: "$[\'Indirizzo posta elettronica\']"\n  phone:\n    type: string\n    $path: "$.Telefono"\n  website:\n    type: string\n    $path: "$[\'Sito internet\']"\n  location:\n    type: object\n    properties:\n      city:\n        type: string\n        $path: "$.Comune"\n      region:\n        type: string\n        $fixed: "Sicily"\n      cap:\n        type: "null"\n')),(0,i.kt)("p",null,"Save it and test it like before:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -H "Content-Type: application/x-yaml" --data-binary @import-accomodation-sicily.yaml http://localhost:6651/api/schema\n')),(0,i.kt)("p",null,"Bulk import this file using the new schema ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce://schema/import/default.accomodation-sicilia"),"."),(0,i.kt)("p",null,"Quering ",(0,i.kt)("inlineCode",{parentName:"p"},"joyce-rest")," you should see also the data from Sicily: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "http://localhost:6650/accomodations?orderBy=asc&sortBy=name&size=5&location.region=Sicily"\n')),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"It's easy to add new sources, just a schema uplaod a file and boom tons of data just in the form you needed, how cool is that?"))),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"This is a simple, but effective use case on how Joyce can be used, but you can have already grasped its potential, following tutorial will be focused on how to setup a connector to automate ingestion."))}p.isMDXComponent=!0},8513:function(e,t,a){"use strict";t.Z=a.p+"assets/images/Schemas-7e2c104335a55488c2213ca374dad2bb.png"}}]);