<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link rel="alternate" type="application/rss+xml" href="/joyce/blog/rss.xml" title="Joyce Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/joyce/blog/atom.xml" title="Joyce Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-56700273-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Import Gateway | Joyce</title><meta data-react-helmet="true" property="og:url" content="https://sourcesense.github.io/joyce/docs/import-gateway"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Import Gateway | Joyce"><meta data-react-helmet="true" name="description" content="The Import Gateway is the single point where you ingest your data into the system."><meta data-react-helmet="true" property="og:description" content="The Import Gateway is the single point where you ingest your data into the system."><link data-react-helmet="true" rel="shortcut icon" href="/joyce/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://sourcesense.github.io/joyce/docs/import-gateway"><link data-react-helmet="true" rel="alternate" href="https://sourcesense.github.io/joyce/docs/import-gateway" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://sourcesense.github.io/joyce/docs/import-gateway" hreflang="x-default"><link rel="stylesheet" href="/joyce/assets/css/styles.ddb7cf01.css">
<link rel="preload" href="/joyce/assets/js/runtime~main.151d7b5b.js" as="script">
<link rel="preload" href="/joyce/assets/js/main.d9cd8811.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/joyce/"><img src="/joyce/img/logo-art-black.png" alt="Joyce" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/joyce/img/logo-art-black.png" alt="Joyce" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Joyce</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/joyce/docs/overview">Documentation</a><a class="navbar__item navbar__link" href="/joyce/getting-started">Getting Started</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sourcesense/joyce" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/joyce/"><img src="/joyce/img/logo-art-black.png" alt="Joyce" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/joyce/img/logo-art-black.png" alt="Joyce" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Joyce</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/joyce/docs/overview">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/getting-started">Getting Started</a></li><li class="menu__list-item"><a href="https://github.com/sourcesense/joyce" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/schema">Schema</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/joyce/docs/import-gateway">Import Gateway</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/connectors">Connectors</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/sink">Mongodb Sink</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/rest">Joyce API</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/event-messaging">Event Messaging</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/joyce-uris">Joyce URIs</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/Extending">Extending</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/Changelog">Changelog</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/joyce/docs/contribute">Contribute</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Import Gateway</h1></header><div class="markdown"><p>The Import Gateway is the single point where you ingest your data into the system.<br>
It manages import schemas and applies them to the content you send to it.</p><p>You can image it as a function that given a schema and a content as input it outputs the content transformed as the schema describes.</p><p>It has two functions: Managing schemas and Import Content.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="import-api"></a>Import API<a class="hash-link" href="#import-api" title="Direct link to heading">#</a></h2><p>Import Gateway has two interface to process source content a <strong>REST API</strong> and a <strong>Kafka Consumer API</strong>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rest-api"></a>REST API<a class="hash-link" href="#rest-api" title="Direct link to heading">#</a></h3><p>Swagger docuemntation can be find here <a href="http://localhost:6651/docs" target="_blank" rel="noopener noreferrer">http://localhost:6651/docs</a>.<br>
To specify the schema to use you have to set a custem header <code>X-Joyce-Schema-Id</code>.<br>
Different endpoints let you insert/delete a single content, bulk insert from a csv or just testing a scehma transformation with a dry run.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="post-apiimport"></a>POST /api/import<a class="hash-link" href="#post-apiimport" title="Direct link to heading">#</a></h4><p>Applies the <strong>schema</strong> specified by <code>X-Joyce-Schema-Id</code>  and publish the processed content to <code>content-topic</code> and returns the id generated for the content.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="delete-apiimport"></a>DELETE /api/import<a class="hash-link" href="#delete-apiimport" title="Direct link to heading">#</a></h4><p>Applies the <strong>schema</strong> specified by <code>X-Joyce-Schema-Id</code> and publish an empty message to mark the deletion of the given content.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="post-apiimportbulk"></a>POST /api/import/bulk<a class="hash-link" href="#post-apiimportbulk" title="Direct link to heading">#</a></h4><p>Applies the <strong>schema</strong> specified by <code>X-Joyce-Schema-Id</code> to every line of the csv sent as multipart along the http request and publish a message to <code>content-topic</code> for every line transofrmed.<br>
The csv has to be valid and the first line is parsed as header giving name to columns.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="post-apiimportdryrun"></a>POST /api/import/dryrun<a class="hash-link" href="#post-apiimportdryrun" title="Direct link to heading">#</a></h4><p>Applies the <strong>schema</strong> specified by <code>X-Joyce-Schema-Id</code> and returns syncronously the result of the processing, WITHOUT pushing it inside kafka.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="kafka-consumer-api"></a>Kafka Consumer API<a class="hash-link" href="#kafka-consumer-api" title="Direct link to heading">#</a></h3><p>Import Gateway consumes messages from <code>joyce_import</code>, it exepcts the message to have a Json message key in this form:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;uid&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;someUniqueValue&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;schema&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;joyce://schema/import/project&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;source&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;jdbc-source-project&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><code>uid</code> is a unique identifier of the imported content </li><li><code>schema</code> is the uri of the schema to apply</li><li><code>source</code> identify the source of the content</li></ul><p>This information can be configured to be set on a <a href="/joyce/docs/connectors">Kafka Connect</a> with a transformation configuration.</p><p>If you specify the <a href="/joyce/docs/schema#connectors">connectors inside the schema</a> the transformation to obtain a suitable key for the scheam is done automatically by import gateway. <strong>This is the preferred way</strong>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="schema-management"></a>Schema Management<a class="hash-link" href="#schema-management" title="Direct link to heading">#</a></h2><p>Input Gateway has a CRUD REST interface to manage <a href="/joyce/docs/schema">Schemas</a>, you can access its swagger documentation at <a href="http://localhost:6651/docs" target="_blank" rel="noopener noreferrer">http://localhost:6651/docs</a>.</p><p>With it you can do what you expect, create, read, update and delete schemas for a namespace, you can also list namespaces.
Updating schemas has few constraints, because the system tries to keep consistency within the data inside the system, preventing changes to the schema that can corrupt previous imported data.</p><p>When you upsert a schema, checks are made to understand what has changed, if there are <strong>breaking changes</strong> the schema cannot be saved.</p><p>Breaking changes are:</p><ul><li>remove a required property</li><li>change the type of property</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="developing-mode"></a>Developing mode<a class="hash-link" href="#developing-mode" title="Direct link to heading">#</a></h3><p>Where you are in the process of developing a schema, you can bypass these checks by flagging the schema in developing mode, by putting this value in the Schema metadata</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">$metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">development</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will save the content but it doesn&#x27;t gurantee that data is validated against the schema when saved in the storage.</p><p>Once you set <code>development: false</code> in a schema you <strong>cannot go back</strong>. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="connectors-api"></a>Connectors API<a class="hash-link" href="#connectors-api" title="Direct link to heading">#</a></h2><p>By configuring connectors directly inside the schema, <code>import-gateway</code> expose additional resources on the schema resource to control kafka connect tasks.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="get-apischemasubtypenamespacenameconnectors"></a>GET /api/schema/{subtype}/{namespace}/{name}/connectors<a class="hash-link" href="#get-apischemasubtypenamespacenameconnectors" title="Direct link to heading">#</a></h4><p>List connectors and their configurations, present in the schema definition.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="get-apischemasubtypenamespacenameconnectorsconnectorstatus"></a>GET /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/status<a class="hash-link" href="#get-apischemasubtypenamespacenameconnectorsconnectorstatus" title="Direct link to heading">#</a></h4><p>Output the status of the connector.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="post-apischemasubtypenamespacenameconnectorsconnectorrestart"></a>POST /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/restart<a class="hash-link" href="#post-apischemasubtypenamespacenameconnectorsconnectorrestart" title="Direct link to heading">#</a></h4><p>Restart the given connector.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="put-apischemasubtypenamespacenameconnectorsconnectorpause"></a>PUT /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/pause<a class="hash-link" href="#put-apischemasubtypenamespacenameconnectorsconnectorpause" title="Direct link to heading">#</a></h4><p>Pause tasks of the given connector.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="put-apischemasubtypenamespacenameconnectorsconnectorresume"></a>PUT /api/schema/{subtype}/{namespace}/{name}/connectors/{connector}/resume<a class="hash-link" href="#put-apischemasubtypenamespacenameconnectorsconnectorresume" title="Direct link to heading">#</a></h4><p>Restart tasks of the given connector.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/sourcesense/joyce/edit/main/docs/docs/40-import-gateway.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/joyce/docs/schema"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« What is a schema?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/joyce/docs/connectors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Connectors Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#import-api" class="table-of-contents__link">Import API</a><ul><li><a href="#rest-api" class="table-of-contents__link">REST API</a></li><li><a href="#kafka-consumer-api" class="table-of-contents__link">Kafka Consumer API</a></li></ul></li><li><a href="#schema-management" class="table-of-contents__link">Schema Management</a><ul><li><a href="#developing-mode" class="table-of-contents__link">Developing mode</a></li></ul></li><li><a href="#connectors-api" class="table-of-contents__link">Connectors API</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://gitter.im/sourcesense/joyce" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://sourcesense.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sourcesense</a></li><li class="footer__item"><a href="https://github.com/sourcesense/joyce" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Sourcesense Spa. Built with Docusaurus.</div></div></div></footer></div>
<script src="/joyce/assets/js/runtime~main.151d7b5b.js"></script>
<script src="/joyce/assets/js/main.d9cd8811.js"></script>
</body>
</html>