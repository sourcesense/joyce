$schema: https://joyce.sourcesense.com/v1/schema
metadata:
  type: import
  domain: test
  product: default
  name: user
  description: A test schema
  production: false
  uid: code
type: object
properties:
  code:
    type: integer
    value: $.src.user_id
  name:
    type: string
    value: $.src.first_name
  surname:
    type: string
    value: $.src.last_name
  full_name:
    type: string
    apply:
      - handler: script
        args:
          language: python
          code: |
            '_'.join([ctx['src']['first_name'].upper(), ctx['src']['last_name'].upper()])
  email:
    type: string
  email_checks:
    type: object
    apply:
      - handler: rest
        args:
          url: https://api.eva.pingutil.com/email?email={{ ctx.src.email }}
          method: GET
          headers:
            Content-Type: application/json
      - handler: extract
        args: $.out.data
    properties:
      valid:
        type: boolean
        value: $.src.valid_syntax
      disposable:
        type: boolean
      spam:
        type: boolean
  kind:
    type: string
    value: SimpleUser
